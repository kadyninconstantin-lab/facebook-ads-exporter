<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Ads Library –≠–∫—Å–ø–æ—Ä—Ç–µ—Ä v3.0</title>
    <style>
        :root {
            --color-primary: #1877f2;
            --color-error: #e74c3c;
            --color-success: #27ae60;
            --color-bg: #f0f2f5;
            --color-text: #050505;
            --color-border: #ccc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #65676b;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .version-badge {
            background: var(--color-success);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--color-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--color-text);
        }

        label .optional {
            color: #65676b;
            font-weight: 400;
            font-size: 12px;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .help-text {
            font-size: 12px;
            color: #65676b;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #165dbf;
            box-shadow: 0 2px 8px rgba(24, 119, 242, 0.3);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: #f0f2f5;
        }

        .btn-download {
            background: var(--color-success);
            color: white;
        }

        .btn-download:hover {
            background: #229954;
        }

        .btn-download:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-info {
            background: #e7f3ff;
            color: #004085;
            border-left: 4px solid #0066cc;
        }

        .alert-error {
            background: #ffe7e7;
            color: #721c24;
            border-left: 4px solid var(--color-error);
        }

        .alert-success {
            background: #e7ffe7;
            color: #155724;
            border-left: 4px solid var(--color-success);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .results-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid var(--color-primary);
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .stat-label {
            font-size: 12px;
            color: #65676b;
            margin-top: 5px;
        }

        .ads-list {
            background: white;
            border-radius: 4px;
            max-height: 600px;
            overflow-y: auto;
        }

        .ad-item {
            padding: 15px;
            border-bottom: 1px solid #e5e5ea;
            font-size: 13px;
        }

        .ad-item:last-child {
            border-bottom: none;
        }

        .ad-title {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 8px;
        }

        .ad-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            color: #65676b;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            color: #333;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e5ea;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #65676b;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .page-info {
            background: white;
            padding: 12px;
            border-radius: 4px;
            border: 1px solid var(--color-primary);
            margin-top: 10px;
            font-size: 13px;
            display: none;
        }

        .page-info.active {
            display: block;
        }

        .page-info strong {
            color: var(--color-primary);
        }

        @media (max-width: 768px) {
            .two-col {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Facebook Ads Library –≠–∫—Å–ø–æ—Ä—Ç–µ—Ä <span class="version-badge">v3.0</span></h1>
        <p class="subtitle">–í—ã–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Facebook Ads Library API | –¢–µ–ø–µ—Ä—å —Å –ø–æ–¥–¥–µ—Ä–∂–∫–æ–π URL!</p>

        <div id="alerts"></div>

        <div class="form-section">
            <div class="two-col">
                <div class="form-group">
                    <label for="accessToken">Access Token *</label>
                    <input type="password" id="accessToken" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Facebook Access Token">
                    <div class="help-text">
                        –ü–æ–ª—É—á–∏—Ç—å: <a href="https://developers.facebook.com/docs/facebook-login/access-tokens" target="_blank">Facebook Developers</a>
                    </div>
                </div>

                <div class="form-group">
                    <label for="pageInput">Page URL –∏–ª–∏ Page ID *</label>
                    <input type="text" id="pageInput" placeholder="https://facebook.com/sierramadregear –∏–ª–∏ 123456789">
                    <div class="help-text">–ú–æ–∂–Ω–æ –≤—Å—Ç–∞–≤–∏—Ç—å URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π ID</div>
                    <div id="pageInfo" class="page-info">
                        <strong>–ù–∞–π–¥–µ–Ω–æ:</strong> <span id="pageName"></span><br>
                        <strong>Page ID:</strong> <span id="pageIdDisplay"></span>
                    </div>
                </div>
            </div>

            <div class="two-col">
                <div class="form-group">
                    <label for="adAccountId">Ad Account ID <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></label>
                    <input type="text" id="adAccountId" placeholder="act_1234567890 (–Ω–µ–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ)">
                    <div class="help-text">–§–æ—Ä–º–∞—Ç: act_XXXXXXXXXX - –º–æ–∂–Ω–æ –æ—Å—Ç–∞–≤–∏—Ç—å –ø—É—Å—Ç—ã–º</div>
                </div>

                <div class="form-group">
                    <label for="adType">–¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏–π</label>
                    <select id="adType">
                        <option value="">-- –í—Å–µ —Ç–∏–ø—ã --</option>
                        <option value="POLITICAL_AND_ISSUE_ADS">–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ</option>
                        <option value="HOUSING">–ñ–∏–ª–æ–µ</option>
                        <option value="EMPLOYMENT">–¢—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</option>
                        <option value="CREDIT">–ö—Ä–µ–¥–∏—Ç</option>
                        <option value="ALL">–í—Å–µ</option>
                    </select>
                </div>
            </div>

            <div class="form-group">
                <label for="searchQuery">–ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å (–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</label>
                <input type="text" id="searchQuery" placeholder="–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞">
            </div>

            <div class="button-group">
                <button class="btn-primary" onclick="fetchAds()">–ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è</button>
                <button class="btn-secondary" onclick="clearForm()">–û—á–∏—Å—Ç–∏—Ç—å</button>
            </div>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('preview')">üìã –ü—Ä–µ–¥–ø—Ä–æ—Å–º–æ—Ç—Ä</button>
            <button class="tab-btn" onclick="switchTab('script')">üíª Python –°–∫—Ä–∏–ø—Ç</button>
            <button class="tab-btn" onclick="switchTab('curl')">üîå cURL –ü—Ä–∏–º–µ—Ä—ã</button>
        </div>

        <div id="preview" class="tab-content active">
            <div id="resultsSection" class="results-section">
                <div class="stats" id="stats"></div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p>–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</p>
                </div>

                <div id="adsContainer" class="ads-list"></div>

                <div style="margin-top: 20px; text-align: center;">
                    <button class="btn-download" onclick="downloadCSV()">üì• –°–∫–∞—á–∞—Ç—å CSV</button>
                    <button class="btn-download" onclick="downloadJSON()" style="margin-left: 10px;">üì• –°–∫–∞—á–∞—Ç—å JSON</button>
                </div>
            </div>
        </div>

        <div id="script" class="tab-content">
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: var(--color-primary);">Python –°–∫—Ä–∏–ø—Ç v3.0</h3>
                <p style="margin-bottom: 15px; font-size: 14px;">–£—Å—Ç–∞–Ω–æ–≤–∏—Ç–µ –∑–∞–≤–∏—Å–∏–º–æ—Å—Ç–∏:</p>
                <div class="code-block">pip install requests</div>

                <p style="margin-top: 15px; margin-bottom: 10px; font-size: 14px;">–°–∫—Ä–∏–ø—Ç:</p>
                <div class="code-block" style="max-height: 600px; overflow-y: auto;">
import requests
import json
import csv
import re
from urllib.parse import urlparse

class FacebookAdsLibraryExporter:
    def __init__(self, access_token):
        self.access_token = access_token
        self.api_version = 'v18.0'
        self.base_url = f'https://graph.facebook.com/{self.api_version}'
        self.ads = []

    def extract_page_id_from_url(self, page_input):
        """
        –ò–∑–≤–ª–µ—á—å Page ID –∏–∑ URL –∏–ª–∏ –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å –µ—Å–ª–∏ —ç—Ç–æ —É–∂–µ ID

        Args:
            page_input: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –∏–ª–∏ —á–∏—Å–ª–æ–≤–æ–π ID

        Returns:
            Page ID (—á–∏—Å–ª–æ–≤–æ–π) –∏–ª–∏ username –¥–ª—è –¥–∞–ª—å–Ω–µ–π—à–µ–≥–æ –∑–∞–ø—Ä–æ—Å–∞
        """
        # –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ - –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å
        if page_input.isdigit():
            return page_input

        # –ò–∑–≤–ª–µ—á—å username –∏–∑ URL
        patterns = [
            r'facebook\.com/([^/?]+)',
            r'fb\.com/([^/?]+)',
            r'fb\.me/([^/?]+)'
        ]

        for pattern in patterns:
            match = re.search(pattern, page_input)
            if match:
                username = match.group(1)
                # –£–¥–∞–ª–∏—Ç—å –ø—Ä–µ—Ñ–∏–∫—Å—ã
                username = username.replace('pages/', '')
                return username

        # –ï—Å–ª–∏ –Ω–∏—á–µ–≥–æ –Ω–µ –Ω–∞–π–¥–µ–Ω–æ, –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å
        return page_input

    def get_page_id(self, page_input):
        """
        –ü–æ–ª—É—á–∏—Ç—å —á–∏—Å–ª–æ–≤–æ–π Page ID –∏–∑ URL –∏–ª–∏ username

        Args:
            page_input: URL, username –∏–ª–∏ ID

        Returns:
            dict —Å page_id –∏ page_name –∏–ª–∏ None
        """
        identifier = self.extract_page_id_from_url(page_input)

        # –ï—Å–ª–∏ —ç—Ç–æ —É–∂–µ —á–∏—Å–ª–æ–≤–æ–π ID, –ø—Ä–æ–≤–µ—Ä–∏–º —á—Ç–æ —Å—Ç—Ä–∞–Ω–∏—Ü–∞ —Å—É—â–µ—Å—Ç–≤—É–µ—Ç
        url = f'{self.base_url}/{identifier}'
        params = {
            'fields': 'id,name',
            'access_token': self.access_token
        }

        try:
            response = requests.get(url, params=params)
            response.raise_for_status()
            data = response.json()

            if 'id' in data:
                print(f"‚úì –ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: {data.get('name', 'Unknown')}")
                print(f"‚úì Page ID: {data['id']}")
                return {
                    'page_id': data['id'],
                    'page_name': data.get('name', 'Unknown')
                }
            else:
                print(f"–û—à–∏–±–∫–∞: –Ω–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Page ID")
                return None

        except requests.exceptions.RequestException as e:
            print(f"–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ Page ID: {e}")
            return None

    def get_ads(self, page_input, ad_type='', search_query='', limit=100):
        """
        –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –∏–∑ Ads Library

        Args:
            page_input: URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã, username –∏–ª–∏ ID
            ad_type: –¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏—è
            search_query: –ü–æ–∏—Å–∫–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å
            limit: –ö–æ–ª–∏—á–µ—Å—Ç–≤–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–µ
        """
        # –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º Page ID
        page_data = self.get_page_id(page_input)
        if not page_data:
            print("–ù–µ —É–¥–∞–ª–æ—Å—å –ø–æ–ª—É—á–∏—Ç—å Page ID. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ URL –∏–ª–∏ ID.")
            return []

        page_id = page_data['page_id']
        url = f'{self.base_url}/ads_archive'

        params = {
            'fields': 'ad_archive_id,ad_creation_time,ad_creative_bodies,ad_delivery_start_time,'
                     'ad_delivery_stop_time,ad_snapshot_url,impressions,spend,media,targeting,'
                     'currency,ad_status',
            'access_token': self.access_token,
            'search_page_ids': page_id,
            'ad_type': ad_type if ad_type else 'ALL',
            'limit': limit,
        }

        if search_query:
            params['search_terms'] = search_query

        all_ads = []
        after = None

        try:
            while True:
                if after:
                    params['after'] = after

                print(f'–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π (—Å—Ç—Ä–∞–Ω–∏—Ü–∞ {len(all_ads)//limit + 1})...')
                response = requests.get(url, params=params)
                response.raise_for_status()

                data = response.json()

                if 'error' in data:
                    print(f"–û—à–∏–±–∫–∞ API: {data['error']['message']}")
                    break

                if 'data' in data:
                    all_ads.extend(data['data'])
                    print(f'–ó–∞–≥—Ä—É–∂–µ–Ω–æ {len(all_ads)} –æ–±—ä—è–≤–ª–µ–Ω–∏–π')

                if 'paging' in data and 'cursors' in data['paging']:
                    after = data['paging']['cursors'].get('after')
                    if not after:
                        break
                else:
                    break

            self.ads = all_ads
            return all_ads

        except requests.exceptions.RequestException as e:
            print(f'–û—à–∏–±–∫–∞ –ø—Ä–∏ –ø–æ–ª—É—á–µ–Ω–∏–∏ –¥–∞–Ω–Ω—ã—Ö: {e}')
            return []

    def save_to_csv(self, filename='ads_export.csv'):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ CSV"""
        if not self.ads:
            print('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞')
            return

        with open(filename, 'w', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            writer.writerow(['ID', '–¢–µ–∫—Å—Ç', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è', '–ù–∞—á–∞–ª–æ –¥–æ—Å—Ç–∞–≤–∫–∏', 
                           '–ö–æ–Ω–µ—Ü –¥–æ—Å—Ç–∞–≤–∫–∏', '–°—Ç–∞—Ç—É—Å', 'Impressions', 'Spend', 'Snapshot URL'])

            for ad in self.ads:
                bodies = ad.get('ad_creative_bodies', [])
                body_text = bodies[0] if bodies else ''

                writer.writerow([
                    ad.get('ad_archive_id', ''),
                    body_text[:200] if body_text else '',
                    ad.get('ad_creation_time', ''),
                    ad.get('ad_delivery_start_time', ''),
                    ad.get('ad_delivery_stop_time', ''),
                    ad.get('ad_status', ''),
                    ad.get('impressions', 0),
                    ad.get('spend', 0),
                    ad.get('ad_snapshot_url', '')
                ])

        print(f'–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {filename}')

    def save_to_json(self, filename='ads_export.json'):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –≤ JSON"""
        if not self.ads:
            print('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —ç–∫—Å–ø–æ—Ä—Ç–∞')
            return

        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(self.ads, f, indent=2, ensure_ascii=False)

        print(f'–î–∞–Ω–Ω—ã–µ —Å–æ—Ö—Ä–∞–Ω–µ–Ω—ã –≤ {filename}')

# –ò—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏–µ
if __name__ == '__main__':
    ACCESS_TOKEN = '–í–ê–®_ACCESS_TOKEN'

    # –ú–æ–∂–Ω–æ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞—Ç—å URL –∏–ª–∏ ID!
    PAGE_INPUT = 'https://www.facebook.com/sierramadregear/'
    # –∏–ª–∏ –ø—Ä–æ—Å—Ç–æ: PAGE_INPUT = '123456789'

    exporter = FacebookAdsLibraryExporter(ACCESS_TOKEN)

    # –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è (–∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç URL –≤ ID)
    ads = exporter.get_ads(
        page_input=PAGE_INPUT,
        ad_type='ALL',
        search_query='',
        limit=100
    )

    print(f'\n–í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {len(ads)} –æ–±—ä—è–≤–ª–µ–Ω–∏–π')

    # –≠–∫—Å–ø–æ—Ä—Ç–∏—Ä–æ–≤–∞—Ç—å
    if ads:
        exporter.save_to_csv('ads_export.csv')
        exporter.save_to_json('ads_export.json')
                </div>
            </div>
        </div>

        <div id="curl" class="tab-content">
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: var(--color-primary);">cURL –ü—Ä–∏–º–µ—Ä—ã</h3>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">1. –ü–æ–ª—É—á–∏—Ç—å Page ID –∏–∑ username/URL:</h4>
                <div class="code-block">curl -X GET "https://graph.facebook.com/v18.0/sierramadregear?fields=id,name&access_token=YOUR_ACCESS_TOKEN"</div>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">2. –ë–∞–∑–æ–≤—ã–π –∑–∞–ø—Ä–æ—Å —Å Page ID:</h4>
                <div class="code-block">curl -X GET "https://graph.facebook.com/v18.0/ads_archive?fields=ad_archive_id,ad_creative_bodies,impressions,spend&search_page_ids=PAGE_ID&ad_type=ALL&access_token=YOUR_ACCESS_TOKEN"</div>

                <h4 style="margin-top: 20px; margin-bottom: 10px;">3. –° –ø–æ–∏—Å–∫–æ–≤—ã–º –∑–∞–ø—Ä–æ—Å–æ–º:</h4>
                <div class="code-block">curl -X GET "https://graph.facebook.com/v18.0/ads_archive?fields=ad_archive_id,ad_creative_bodies&search_page_ids=PAGE_ID&search_terms=keyword&ad_type=ALL&access_token=YOUR_ACCESS_TOKEN"</div>

                <div class="alert alert-info" style="margin-top: 20px;">
                    <strong>‚ú® –ù–æ–≤–æ–µ –≤ v3.0:</strong><br>
                    –¢–µ–ø–µ—Ä—å –ø—Ä–∏–ª–æ–∂–µ–Ω–∏–µ –∞–≤—Ç–æ–º–∞—Ç–∏—á–µ—Å–∫–∏ –∫–æ–Ω–≤–µ—Ä—Ç–∏—Ä—É–µ—Ç URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã –≤ Page ID!<br>
                    –ü—Ä–æ—Å—Ç–æ –≤—Å—Ç–∞–≤—å—Ç–µ: <code>https://facebook.com/username</code>
                </div>
            </div>
        </div>
    </div>

    <script>
        let allAds = [];
        let currentPageId = null;

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è username –∏–∑ URL
        function extractPageIdentifier(input) {
            input = input.trim();

            // –ï—Å–ª–∏ —ç—Ç–æ –ø—Ä–æ—Å—Ç–æ —á–∏—Å–ª–æ - –≤–µ—Ä–Ω—É—Ç—å –∫–∞–∫ –µ—Å—Ç—å
            if (/^\d+$/.test(input)) {
                return input;
            }

            // –ü–∞—Ç—Ç–µ—Ä–Ω—ã –¥–ª—è –∏–∑–≤–ª–µ—á–µ–Ω–∏—è username
            const patterns = [
                /facebook\.com\/([^/?]+)/,
                /fb\.com\/([^/?]+)/,
                /fb\.me\/([^/?]+)/
            ];

            for (let pattern of patterns) {
                const match = input.match(pattern);
                if (match) {
                    let username = match[1];
                    username = username.replace('pages/', '');
                    return username;
                }
            }

            return input;
        }

        // –§—É–Ω–∫—Ü–∏—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è Page ID
        async function getPageId(pageInput, accessToken) {
            const identifier = extractPageIdentifier(pageInput);
            const url = `https://graph.facebook.com/v18.0/${identifier}?fields=id,name&access_token=${accessToken}`;

            try {
                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    throw new Error(data.error.message);
                }

                if (data.id) {
                    return {
                        id: data.id,
                        name: data.name || 'Unknown'
                    };
                }

                throw new Error('Page ID –Ω–µ –Ω–∞–π–¥–µ–Ω');
            } catch (error) {
                throw error;
            }
        }

        async function fetchAds() {
            const accessToken = document.getElementById('accessToken').value;
            const pageInput = document.getElementById('pageInput').value;
            const adType = document.getElementById('adType').value;
            const searchQuery = document.getElementById('searchQuery').value;

            if (!accessToken || !pageInput) {
                showAlert('–ü–æ–∂–∞–ª—É–π—Å—Ç–∞, –∑–∞–ø–æ–ª–Ω–∏—Ç–µ –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–æ–ª—è: Access Token –∏ Page URL/ID', 'error');
                return;
            }

            showLoading(true);
            clearAlerts();
            document.getElementById('pageInfo').classList.remove('active');

            try {
                // –°–Ω–∞—á–∞–ª–∞ –ø–æ–ª—É—á–∞–µ–º Page ID
                showAlert('–ü–æ–ª—É—á–µ–Ω–∏–µ Page ID...', 'info');
                const pageData = await getPageId(pageInput, accessToken);

                currentPageId = pageData.id;
                document.getElementById('pageName').textContent = pageData.name;
                document.getElementById('pageIdDisplay').textContent = pageData.id;
                document.getElementById('pageInfo').classList.add('active');

                clearAlerts();
                showAlert(`–ù–∞–π–¥–µ–Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü–∞: ${pageData.name}`, 'success');

                // –¢–µ–ø–µ—Ä—å –ø–æ–ª—É—á–∞–µ–º –æ–±—ä—è–≤–ª–µ–Ω–∏—è
                const url = new URL('https://graph.facebook.com/v18.0/ads_archive');
                url.searchParams.append('fields', 'ad_archive_id,ad_creation_time,ad_creative_bodies,ad_delivery_start_time,ad_delivery_stop_time,impressions,spend,ad_status,media,ad_snapshot_url');
                url.searchParams.append('search_page_ids', pageData.id);
                url.searchParams.append('ad_type', adType || 'ALL');
                url.searchParams.append('access_token', accessToken);
                url.searchParams.append('limit', '100');

                if (searchQuery) {
                    url.searchParams.append('search_terms', searchQuery);
                }

                const response = await fetch(url);
                const data = await response.json();

                if (data.error) {
                    showAlert(`–û—à–∏–±–∫–∞ API: ${data.error.message}`, 'error');
                    showLoading(false);
                    return;
                }

                allAds = data.data || [];
                displayResults(allAds);
                showAlert(`–£—Å–ø–µ—à–Ω–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ ${allAds.length} –æ–±—ä—è–≤–ª–µ–Ω–∏–π –¥–ª—è —Å—Ç—Ä–∞–Ω–∏—Ü—ã "${pageData.name}"`, 'success');

            } catch (error) {
                showAlert(`–û—à–∏–±–∫–∞: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        function displayResults(ads) {
            const resultsSection = document.getElementById('resultsSection');
            resultsSection.classList.add('active');

            const stats = {
                total: ads.length,
                activeAds: ads.filter(a => a.ad_status === 'ACTIVE').length,
                totalSpend: ads.reduce((sum, a) => {
                    const spend = a.spend?.lower_bound || a.spend || 0;
                    return sum + parseFloat(spend);
                }, 0),
                totalImpressions: ads.reduce((sum, a) => {
                    const impressions = a.impressions?.lower_bound || a.impressions || 0;
                    return sum + parseInt(impressions);
                }, 0)
            };

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">–í—Å–µ–≥–æ –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.activeAds}</div>
                    <div class="stat-label">–ê–∫—Ç–∏–≤–Ω—ã—Ö</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">$${stats.totalSpend.toFixed(2)}</div>
                    <div class="stat-label">–û–±—â–∞—è —Ç—Ä–∞—Ç–∞</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.totalImpressions.toLocaleString()}</div>
                    <div class="stat-label">Impressions</div>
                </div>
            `;

            const adsHtml = ads.map(ad => {
                const creative = ad.ad_creative_bodies?.[0] || '–¢–µ–∫—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                const creativeText = typeof creative === 'string' ? creative : (creative.body || '–¢–µ–∫—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω');
                return `
                    <div class="ad-item">
                        <div class="ad-title">${creativeText.substring(0, 100)}...</div>
                        <div class="ad-meta">
                            <div class="meta-item">
                                <span>ID:</span>
                                <span>${ad.ad_archive_id || 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span>–°—Ç–∞—Ç—É—Å:</span>
                                <span>${ad.ad_status || 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span>Impressions:</span>
                                <span>${ad.impressions?.lower_bound || ad.impressions || 0}</span>
                            </div>
                            <div class="meta-item">
                                <span>Spend:</span>
                                <span>$${ad.spend?.lower_bound || ad.spend || 0}</span>
                            </div>
                            <div class="meta-item">
                                <span>–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è:</span>
                                <span>${ad.ad_creation_time || 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span>–ù–∞—á–∞–ª–æ –¥–æ—Å—Ç–∞–≤–∫–∏:</span>
                                <span>${ad.ad_delivery_start_time || 'N/A'}</span>
                            </div>
                        </div>
                    </div>
                `;
            }).join('');

            document.getElementById('adsContainer').innerHTML = adsHtml || '<p style="padding: 20px; text-align: center; color: #999;">–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
        }

        function downloadCSV() {
            if (allAds.length === 0) {
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            const headers = ['ID', '–¢–µ–∫—Å—Ç', '–°—Ç–∞—Ç—É—Å', 'Impressions', 'Spend', '–î–∞—Ç–∞ —Å–æ–∑–¥–∞–Ω–∏—è', '–ù–∞—á–∞–ª–æ –¥–æ—Å—Ç–∞–≤–∫–∏', 'Snapshot URL'];
            const rows = allAds.map(ad => {
                const creative = ad.ad_creative_bodies?.[0] || '';
                const creativeText = typeof creative === 'string' ? creative : (creative.body || '');

                return [
                    ad.ad_archive_id || '',
                    creativeText.replace(/"/g, '""'),
                    ad.ad_status || '',
                    ad.impressions?.lower_bound || ad.impressions || 0,
                    ad.spend?.lower_bound || ad.spend || 0,
                    ad.ad_creation_time || '',
                    ad.ad_delivery_start_time || '',
                    ad.ad_snapshot_url || ''
                ];
            });

            const csv = [headers, ...rows].map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');

            downloadFile(csv, 'ads_export.csv', 'text/csv');
        }

        function downloadJSON() {
            if (allAds.length === 0) {
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            const json = JSON.stringify(allAds, null, 2);
            downloadFile(json, 'ads_export.json', 'application/json');
        }

        function downloadFile(content, filename, type) {
            const blob = new Blob([content], { type });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function showAlert(message, type) {
            const alertsDiv = document.getElementById('alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.textContent = message;
            alertsDiv.appendChild(alertDiv);

            setTimeout(() => alertDiv.remove(), 5000);
        }

        function clearAlerts() {
            document.getElementById('alerts').innerHTML = '';
        }

        function showLoading(show) {
            document.getElementById('loading').classList.toggle('active', show);
        }

        function clearForm() {
            document.getElementById('accessToken').value = '';
            document.getElementById('pageInput').value = '';
            document.getElementById('adAccountId').value = '';
            document.getElementById('adType').value = '';
            document.getElementById('searchQuery').value = '';
            document.getElementById('resultsSection').classList.remove('active');
            document.getElementById('pageInfo').classList.remove('active');
            allAds = [];
            currentPageId = null;
            clearAlerts();
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
        }
    </script>
</body>
</html>

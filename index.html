<!DOCTYPE html>
<html lang="ru">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Facebook Ads Library –≠–∫—Å–ø–æ—Ä—Ç–µ—Ä v4.0</title>
    <style>
        :root {
            --color-primary: #1877f2;
            --color-error: #e74c3c;
            --color-success: #27ae60;
            --color-bg: #f0f2f5;
            --color-text: #050505;
            --color-border: #ccc;
        }

        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }

        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Helvetica, Arial, sans-serif;
            background: var(--color-bg);
            color: var(--color-text);
            padding: 20px;
        }

        .container {
            max-width: 1200px;
            margin: 0 auto;
            background: white;
            border-radius: 8px;
            box-shadow: 0 2px 4px rgba(0,0,0,0.1);
            padding: 30px;
        }

        h1 {
            color: var(--color-primary);
            margin-bottom: 10px;
            font-size: 28px;
        }

        .subtitle {
            color: #65676b;
            margin-bottom: 30px;
            font-size: 14px;
        }

        .version-badge {
            background: var(--color-success);
            color: white;
            padding: 4px 12px;
            border-radius: 12px;
            font-size: 12px;
            font-weight: 600;
            display: inline-block;
            margin-left: 10px;
        }

        .form-section {
            margin-bottom: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            border-left: 4px solid var(--color-primary);
        }

        .form-group {
            margin-bottom: 20px;
        }

        label {
            display: block;
            margin-bottom: 8px;
            font-weight: 600;
            font-size: 14px;
            color: var(--color-text);
        }

        label .optional {
            color: #65676b;
            font-weight: 400;
            font-size: 12px;
        }

        label .required {
            color: var(--color-error);
            font-weight: 600;
        }

        input, select {
            width: 100%;
            padding: 12px;
            border: 1px solid var(--color-border);
            border-radius: 4px;
            font-size: 14px;
            font-family: inherit;
        }

        input:focus, select:focus {
            outline: none;
            border-color: var(--color-primary);
            box-shadow: 0 0 0 3px rgba(24, 119, 242, 0.1);
        }

        .help-text {
            font-size: 12px;
            color: #65676b;
            margin-top: 5px;
        }

        .button-group {
            display: flex;
            gap: 10px;
            margin-top: 20px;
            flex-wrap: wrap;
        }

        button {
            padding: 12px 24px;
            border: none;
            border-radius: 4px;
            font-size: 14px;
            font-weight: 600;
            cursor: pointer;
            transition: all 0.2s;
        }

        .btn-primary {
            background: var(--color-primary);
            color: white;
        }

        .btn-primary:hover {
            background: #165dbf;
            box-shadow: 0 2px 8px rgba(24, 119, 242, 0.3);
        }

        .btn-primary:disabled {
            background: #ccc;
            cursor: not-allowed;
            opacity: 0.6;
        }

        .btn-secondary {
            background: white;
            color: var(--color-primary);
            border: 2px solid var(--color-primary);
        }

        .btn-secondary:hover {
            background: #f0f2f5;
        }

        .btn-download {
            background: var(--color-success);
            color: white;
        }

        .btn-download:hover {
            background: #229954;
        }

        .btn-download:disabled {
            background: #ccc;
            cursor: not-allowed;
        }

        .alert {
            padding: 15px;
            border-radius: 4px;
            margin-bottom: 20px;
            font-size: 14px;
        }

        .alert-info {
            background: #e7f3ff;
            color: #004085;
            border-left: 4px solid #0066cc;
        }

        .alert-error {
            background: #ffe7e7;
            color: #721c24;
            border-left: 4px solid var(--color-error);
        }

        .alert-success {
            background: #e7ffe7;
            color: #155724;
            border-left: 4px solid var(--color-success);
        }

        .alert-warning {
            background: #fff3cd;
            color: #856404;
            border-left: 4px solid #ffc107;
        }

        .results-section {
            margin-top: 30px;
            padding: 20px;
            background: #f8f9fa;
            border-radius: 8px;
            display: none;
        }

        .results-section.active {
            display: block;
        }

        .stats {
            display: grid;
            grid-template-columns: repeat(auto-fit, minmax(150px, 1fr));
            gap: 15px;
            margin-bottom: 20px;
        }

        .stat-card {
            background: white;
            padding: 15px;
            border-radius: 4px;
            border-left: 4px solid var(--color-primary);
            text-align: center;
        }

        .stat-number {
            font-size: 24px;
            font-weight: 700;
            color: var(--color-primary);
        }

        .stat-label {
            font-size: 12px;
            color: #65676b;
            margin-top: 5px;
        }

        .ads-list {
            background: white;
            border-radius: 4px;
            max-height: 600px;
            overflow-y: auto;
        }

        .ad-item {
            padding: 15px;
            border-bottom: 1px solid #e5e5ea;
            font-size: 13px;
        }

        .ad-item:last-child {
            border-bottom: none;
        }

        .ad-title {
            font-weight: 600;
            color: var(--color-primary);
            margin-bottom: 8px;
        }

        .ad-meta {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 10px;
            color: #65676b;
        }

        .meta-item {
            display: flex;
            justify-content: space-between;
        }

        .ad-link {
            margin-top: 10px;
        }

        .ad-link a {
            color: var(--color-primary);
            text-decoration: none;
            font-size: 12px;
        }

        .ad-link a:hover {
            text-decoration: underline;
        }

        .loading {
            display: none;
            text-align: center;
            padding: 20px;
        }

        .loading.active {
            display: block;
        }

        .spinner {
            border: 3px solid #f3f3f3;
            border-top: 3px solid var(--color-primary);
            border-radius: 50%;
            width: 40px;
            height: 40px;
            animation: spin 1s linear infinite;
            margin: 0 auto 10px;
        }

        @keyframes spin {
            0% { transform: rotate(0deg); }
            100% { transform: rotate(360deg); }
        }

        .code-block {
            background: #f5f5f5;
            border: 1px solid #ddd;
            border-radius: 4px;
            padding: 12px;
            margin-top: 10px;
            font-family: 'Courier New', monospace;
            font-size: 12px;
            overflow-x: auto;
            color: #333;
        }

        .tabs {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
            border-bottom: 2px solid #e5e5ea;
        }

        .tab-btn {
            background: none;
            border: none;
            padding: 12px 20px;
            cursor: pointer;
            font-weight: 600;
            color: #65676b;
            border-bottom: 3px solid transparent;
            transition: all 0.2s;
        }

        .tab-btn.active {
            color: var(--color-primary);
            border-bottom-color: var(--color-primary);
        }

        .tab-content {
            display: none;
        }

        .tab-content.active {
            display: block;
        }

        .two-col {
            display: grid;
            grid-template-columns: 1fr 1fr;
            gap: 20px;
        }

        .three-col {
            display: grid;
            grid-template-columns: 1fr 1fr 1fr;
            gap: 20px;
        }

        .search-mode-toggle {
            display: flex;
            gap: 10px;
            margin-bottom: 20px;
        }

        .mode-btn {
            flex: 1;
            padding: 15px;
            border: 2px solid var(--color-border);
            border-radius: 8px;
            background: white;
            cursor: pointer;
            transition: all 0.2s;
        }

        .mode-btn.active {
            border-color: var(--color-primary);
            background: #e7f3ff;
        }

        .mode-btn h4 {
            color: var(--color-primary);
            margin-bottom: 5px;
        }

        .mode-btn p {
            font-size: 12px;
            color: #65676b;
        }

        .country-select {
            display: grid;
            grid-template-columns: repeat(auto-fill, minmax(100px, 1fr));
            gap: 8px;
            max-height: 150px;
            overflow-y: auto;
            padding: 10px;
            background: white;
            border: 1px solid var(--color-border);
            border-radius: 4px;
        }

        .country-checkbox {
            display: flex;
            align-items: center;
            gap: 5px;
            font-size: 13px;
        }

        .country-checkbox input {
            width: auto;
        }

        @media (max-width: 768px) {
            .two-col, .three-col {
                grid-template-columns: 1fr;
            }

            .container {
                padding: 20px;
            }

            h1 {
                font-size: 22px;
            }
        }
    </style>
</head>
<body>
    <div class="container">
        <h1>üìä Facebook Ads Library –≠–∫—Å–ø–æ—Ä—Ç–µ—Ä <span class="version-badge">v4.0 Fixed</span></h1>
        <p class="subtitle">–í—ã–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π —á–µ—Ä–µ–∑ Facebook Ads Library API | –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–∞ —Ä–∞–±–æ—Ç–∞ —Å permissions</p>

        <div id="alerts"></div>

        <div class="alert alert-info">
            <strong>‚ÑπÔ∏è –í–∞–∂–Ω–æ:</strong> Ads Library API —Ç—Ä–µ–±—É–µ—Ç –ø–∞—Ä–∞–º–µ—Ç—Ä <code>ad_reached_countries</code>. 
            –î–ª—è –ø–æ–∏—Å–∫–∞ –ø–æ Page ID –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ —á–∏—Å–ª–æ–≤–æ–π ID (–º–æ–∂–Ω–æ –Ω–∞–π—Ç–∏ —á–µ—Ä–µ–∑ lookup-id.com).
        </div>

        <div class="form-section">
            <h3 style="margin-bottom: 15px; color: var(--color-primary);">üîë –ê–≤—Ç–æ—Ä–∏–∑–∞—Ü–∏—è</h3>
            
            <div class="form-group">
                <label for="accessToken">Access Token <span class="required">*</span></label>
                <input type="password" id="accessToken" placeholder="–í–≤–µ–¥–∏—Ç–µ –≤–∞—à Facebook Access Token">
                <div class="help-text">
                    User Token —Å permissions: ads_read, ads_management
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3 style="margin-bottom: 15px; color: var(--color-primary);">üîç –†–µ–∂–∏–º –ø–æ–∏—Å–∫–∞</h3>
            
            <div class="search-mode-toggle">
                <button class="mode-btn active" onclick="setSearchMode('page')" id="mode-page">
                    <h4>üìÑ –ü–æ Page ID</h4>
                    <p>–ü–æ–∏—Å–∫ –≤—Å–µ—Ö –æ–±—ä—è–≤–ª–µ–Ω–∏–π –∫–æ–Ω–∫—Ä–µ—Ç–Ω–æ–π —Å—Ç—Ä–∞–Ω–∏—Ü—ã</p>
                </button>
                <button class="mode-btn" onclick="setSearchMode('keyword')" id="mode-keyword">
                    <h4>üî§ –ü–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º</h4>
                    <p>–ü–æ–∏—Å–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π –ø–æ —Ç–µ–∫—Å—Ç—É</p>
                </button>
            </div>

            <div id="pageSearchFields">
                <div class="form-group">
                    <label for="pageId">Page ID <span class="required">*</span></label>
                    <input type="text" id="pageId" placeholder="–ß–∏—Å–ª–æ–≤–æ–π ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã, –Ω–∞–ø—Ä–∏–º–µ—Ä: 123456789">
                    <div class="help-text">
                        –ö–∞–∫ –Ω–∞–π—Ç–∏ Page ID: –∏—Å–ø–æ–ª—å–∑—É–π—Ç–µ <a href="https://lookup-id.com" target="_blank">lookup-id.com</a> 
                        –∏–ª–∏ –Ω–∞–π–¥–∏—Ç–µ –≤ URL —Å—Ç—Ä–∞–Ω–∏—Ü—ã Facebook
                    </div>
                </div>
            </div>

            <div id="keywordSearchFields" style="display: none;">
                <div class="form-group">
                    <label for="searchTerms">–ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ <span class="required">*</span></label>
                    <input type="text" id="searchTerms" placeholder="–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞">
                    <div class="help-text">–ü–æ–∏—Å–∫ –ø–æ —Ç–µ–∫—Å—Ç—É –æ–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                </div>
            </div>
        </div>

        <div class="form-section">
            <h3 style="margin-bottom: 15px; color: var(--color-primary);">üåç –°—Ç—Ä–∞–Ω—ã –ø–æ–∫–∞–∑–∞ <span class="required">*</span></h3>
            <p style="font-size: 13px; color: #65676b; margin-bottom: 10px;">–í—ã–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω—É (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–π –ø–∞—Ä–∞–º–µ—Ç—Ä API)</p>
            
            <div class="country-select" id="countrySelect">
                <label class="country-checkbox"><input type="checkbox" value="US" checked> üá∫üá∏ US</label>
                <label class="country-checkbox"><input type="checkbox" value="GB"> üá¨üáß UK</label>
                <label class="country-checkbox"><input type="checkbox" value="DE"> üá©üá™ DE</label>
                <label class="country-checkbox"><input type="checkbox" value="FR"> üá´üá∑ FR</label>
                <label class="country-checkbox"><input type="checkbox" value="IT"> üáÆüáπ IT</label>
                <label class="country-checkbox"><input type="checkbox" value="ES"> üá™üá∏ ES</label>
                <label class="country-checkbox"><input type="checkbox" value="CA"> üá®üá¶ CA</label>
                <label class="country-checkbox"><input type="checkbox" value="AU"> üá¶üá∫ AU</label>
                <label class="country-checkbox"><input type="checkbox" value="BR"> üáßüá∑ BR</label>
                <label class="country-checkbox"><input type="checkbox" value="MX"> üá≤üáΩ MX</label>
                <label class="country-checkbox"><input type="checkbox" value="IN"> üáÆüá≥ IN</label>
                <label class="country-checkbox"><input type="checkbox" value="JP"> üáØüáµ JP</label>
                <label class="country-checkbox"><input type="checkbox" value="KR"> üá∞üá∑ KR</label>
                <label class="country-checkbox"><input type="checkbox" value="PL"> üáµüá± PL</label>
                <label class="country-checkbox"><input type="checkbox" value="NL"> üá≥üá± NL</label>
                <label class="country-checkbox"><input type="checkbox" value="UA"> üá∫üá¶ UA</label>
                <label class="country-checkbox"><input type="checkbox" value="RU"> üá∑üá∫ RU</label>
                <label class="country-checkbox"><input type="checkbox" value="ALL"> üåê ALL</label>
            </div>
        </div>

        <div class="form-section">
            <h3 style="margin-bottom: 15px; color: var(--color-primary);">‚öôÔ∏è –î–æ–ø–æ–ª–Ω–∏—Ç–µ–ª—å–Ω—ã–µ —Ñ–∏–ª—å—Ç—Ä—ã</h3>
            
            <div class="three-col">
                <div class="form-group">
                    <label for="adType">–¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏–π</label>
                    <select id="adType">
                        <option value="ALL">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="POLITICAL_AND_ISSUE_ADS">–ü–æ–ª–∏—Ç–∏—á–µ—Å–∫–∏–µ</option>
                        <option value="HOUSING">–ù–µ–¥–≤–∏–∂–∏–º–æ—Å—Ç—å</option>
                        <option value="EMPLOYMENT">–¢—Ä—É–¥–æ—É—Å—Ç—Ä–æ–π—Å—Ç–≤–æ</option>
                        <option value="CREDIT">–ö—Ä–µ–¥–∏—Ç—ã</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="adStatus">–°—Ç–∞—Ç—É—Å –æ–±—ä—è–≤–ª–µ–Ω–∏–π</label>
                    <select id="adStatus">
                        <option value="">–í—Å–µ —Å—Ç–∞—Ç—É—Å—ã</option>
                        <option value="ACTIVE">–ê–∫—Ç–∏–≤–Ω—ã–µ</option>
                        <option value="INACTIVE">–ù–µ–∞–∫—Ç–∏–≤–Ω—ã–µ</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="limit">–õ–∏–º–∏—Ç —Ä–µ–∑—É–ª—å—Ç–∞—Ç–æ–≤</label>
                    <select id="limit">
                        <option value="25">25</option>
                        <option value="50">50</option>
                        <option value="100" selected>100</option>
                        <option value="250">250</option>
                        <option value="500">500</option>
                    </select>
                </div>
            </div>

            <div class="two-col">
                <div class="form-group">
                    <label for="mediaType">–¢–∏–ø –º–µ–¥–∏–∞ <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></label>
                    <select id="mediaType">
                        <option value="">–í—Å–µ —Ç–∏–ø—ã</option>
                        <option value="IMAGE">–ò–∑–æ–±—Ä–∞–∂–µ–Ω–∏—è</option>
                        <option value="VIDEO">–í–∏–¥–µ–æ</option>
                        <option value="MEME">Meme</option>
                        <option value="NONE">–ë–µ–∑ –º–µ–¥–∏–∞</option>
                    </select>
                </div>

                <div class="form-group">
                    <label for="publisherPlatform">–ü–ª–∞—Ç—Ñ–æ—Ä–º–∞ <span class="optional">(–æ–ø—Ü–∏–æ–Ω–∞–ª—å–Ω–æ)</span></label>
                    <select id="publisherPlatform">
                        <option value="">–í—Å–µ –ø–ª–∞—Ç—Ñ–æ—Ä–º—ã</option>
                        <option value="FACEBOOK">Facebook</option>
                        <option value="INSTAGRAM">Instagram</option>
                        <option value="AUDIENCE_NETWORK">Audience Network</option>
                        <option value="MESSENGER">Messenger</option>
                    </select>
                </div>
            </div>
        </div>

        <div class="button-group">
            <button class="btn-primary" onclick="fetchAds()" id="fetchBtn">üîç –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è</button>
            <button class="btn-secondary" onclick="clearForm()">üóëÔ∏è –û—á–∏—Å—Ç–∏—Ç—å</button>
            <button class="btn-secondary" onclick="testConnection()">üîå –¢–µ—Å—Ç –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è</button>
        </div>

        <div class="tabs">
            <button class="tab-btn active" onclick="switchTab('preview')">üìã –†–µ–∑—É–ª—å—Ç–∞—Ç—ã</button>
            <button class="tab-btn" onclick="switchTab('request')">üì° –ó–∞–ø—Ä–æ—Å API</button>
            <button class="tab-btn" onclick="switchTab('python')">üêç Python</button>
        </div>

        <div id="preview" class="tab-content active">
            <div id="resultsSection" class="results-section">
                <div class="stats" id="stats"></div>

                <div class="loading" id="loading">
                    <div class="spinner"></div>
                    <p id="loadingText">–ó–∞–≥—Ä—É–∑–∫–∞ –æ–±—ä—è–≤–ª–µ–Ω–∏–π...</p>
                </div>

                <div id="adsContainer" class="ads-list"></div>

                <div style="margin-top: 20px; text-align: center;" id="downloadButtons">
                    <button class="btn-download" onclick="downloadCSV()">üì• –°–∫–∞—á–∞—Ç—å CSV</button>
                    <button class="btn-download" onclick="downloadJSON()" style="margin-left: 10px;">üì• –°–∫–∞—á–∞—Ç—å JSON</button>
                </div>
            </div>
        </div>

        <div id="request" class="tab-content">
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: var(--color-primary);">–°—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å</h3>
                <p style="font-size: 13px; color: #65676b; margin-bottom: 10px;">URL –∑–∞–ø—Ä–æ—Å–∞ –∫ API (–∑–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –≤—ã—à–µ):</p>
                <div class="code-block" id="requestUrl" style="word-break: break-all;">
                    –ó–∞–ø–æ–ª–Ω–∏—Ç–µ —Ñ–æ—Ä–º—É –∏ –Ω–∞–∂–º–∏—Ç–µ "–ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è" —á—Ç–æ–±—ã —É–≤–∏–¥–µ—Ç—å –∑–∞–ø—Ä–æ—Å
                </div>
                
                <h4 style="margin-top: 20px; margin-bottom: 10px;">cURL –∫–æ–º–∞–Ω–¥–∞:</h4>
                <div class="code-block" id="curlCommand" style="word-break: break-all;">
                    curl –±—É–¥–µ—Ç —Å—Ñ–æ—Ä–º–∏—Ä–æ–≤–∞–Ω –ø–æ—Å–ª–µ –∑–∞–ø–æ–ª–Ω–µ–Ω–∏—è —Ñ–æ—Ä–º—ã
                </div>
            </div>
        </div>

        <div id="python" class="tab-content">
            <div style="background: white; padding: 20px; border-radius: 8px;">
                <h3 style="margin-bottom: 15px; color: var(--color-primary);">Python –°–∫—Ä–∏–ø—Ç v4.0</h3>
                <div class="code-block" style="max-height: 600px; overflow-y: auto; white-space: pre;">
import requests
import json
import csv
from datetime import datetime

class FacebookAdsLibraryAPI:
    """
    Facebook Ads Library API Client v4.0
    –ò—Å–ø—Ä–∞–≤–ª–µ–Ω–Ω–∞—è –≤–µ—Ä—Å–∏—è —Å –æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–º–∏ –ø–∞—Ä–∞–º–µ—Ç—Ä–∞–º–∏
    """
    
    def __init__(self, access_token):
        self.access_token = access_token
        self.api_version = 'v21.0'
        self.base_url = f'https://graph.facebook.com/{self.api_version}'
        self.ads = []
    
    def get_ads_by_page(self, page_id, countries=['US'], ad_type='ALL', 
                        limit=100, ad_status=None):
        """
        –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ Page ID
        
        Args:
            page_id: –ß–∏—Å–ª–æ–≤–æ–π ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã Facebook
            countries: –°–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
            ad_type: –¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏–π
            limit: –õ–∏–º–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            ad_status: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É (ACTIVE/INACTIVE)
        """
        return self._fetch_ads(
            search_page_ids=page_id,
            countries=countries,
            ad_type=ad_type,
            limit=limit,
            ad_status=ad_status
        )
    
    def get_ads_by_keyword(self, search_terms, countries=['US'], 
                           ad_type='ALL', limit=100, ad_status=None):
        """
        –ü–æ–ª—É—á–∏—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏—è –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º
        
        Args:
            search_terms: –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞
            countries: –°–ø–∏—Å–æ–∫ –∫–æ–¥–æ–≤ —Å—Ç—Ä–∞–Ω (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
            ad_type: –¢–∏–ø –æ–±—ä—è–≤–ª–µ–Ω–∏–π
            limit: –õ–∏–º–∏—Ç –Ω–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—É
            ad_status: –§–∏–ª—å—Ç—Ä –ø–æ —Å—Ç–∞—Ç—É—Å—É
        """
        return self._fetch_ads(
            search_terms=search_terms,
            countries=countries,
            ad_type=ad_type,
            limit=limit,
            ad_status=ad_status
        )
    
    def _fetch_ads(self, search_page_ids=None, search_terms=None,
                   countries=['US'], ad_type='ALL', limit=100, ad_status=None):
        """–í–Ω—É—Ç—Ä–µ–Ω–Ω–∏–π –º–µ—Ç–æ–¥ –¥–ª—è –∑–∞–ø—Ä–æ—Å–æ–≤ –∫ API"""
        
        url = f'{self.base_url}/ads_archive'
        
        # –ë–∞–∑–æ–≤—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ)
        params = {
            'access_token': self.access_token,
            'ad_reached_countries': json.dumps(countries),  # –û–ë–Ø–ó–ê–¢–ï–õ–¨–ù–û!
            'ad_type': ad_type,
            'limit': limit,
            'fields': ','.join([
                'id',
                'ad_archive_id', 
                'ad_creation_time',
                'ad_creative_bodies',
                'ad_creative_link_captions',
                'ad_creative_link_descriptions',
                'ad_creative_link_titles',
                'ad_delivery_start_time',
                'ad_delivery_stop_time',
                'ad_snapshot_url',
                'bylines',
                'currency',
                'delivery_by_region',
                'demographic_distribution',
                'estimated_audience_size',
                'impressions',
                'languages',
                'page_id',
                'page_name',
                'publisher_platforms',
                'spend',
                'target_ages',
                'target_gender',
                'target_locations'
            ])
        }
        
        # –£—Å–ª–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
        if search_page_ids:
            params['search_page_ids'] = search_page_ids
        
        if search_terms:
            params['search_terms'] = search_terms
        
        if ad_status:
            params['ad_active_status'] = ad_status
        
        all_ads = []
        page_count = 0
        
        try:
            while True:
                page_count += 1
                print(f'üì• –ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã {page_count}...')
                
                response = requests.get(url, params=params)
                data = response.json()
                
                if 'error' in data:
                    print(f'‚ùå –û—à–∏–±–∫–∞ API: {data["error"]["message"]}')
                    print(f'   –ö–æ–¥: {data["error"].get("code")}')
                    print(f'   –¢–∏–ø: {data["error"].get("type")}')
                    break
                
                if 'data' in data:
                    all_ads.extend(data['data'])
                    print(f'   ‚úì –ó–∞–≥—Ä—É–∂–µ–Ω–æ: {len(all_ads)} –æ–±—ä—è–≤–ª–µ–Ω–∏–π')
                
                # –ü–∞–≥–∏–Ω–∞—Ü–∏—è
                if 'paging' in data and 'next' in data['paging']:
                    url = data['paging']['next']
                    params = {}  # URL —É–∂–µ —Å–æ–¥–µ—Ä–∂–∏—Ç –≤—Å–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
                else:
                    break
            
            self.ads = all_ads
            print(f'\n‚úÖ –í—Å–µ–≥–æ –∑–∞–≥—Ä—É–∂–µ–Ω–æ: {len(all_ads)} –æ–±—ä—è–≤–ª–µ–Ω–∏–π')
            return all_ads
            
        except Exception as e:
            print(f'‚ùå –û—à–∏–±–∫–∞: {e}')
            return []
    
    def save_csv(self, filename=None):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ CSV"""
        if not self.ads:
            print('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è')
            return
        
        if not filename:
            filename = f'fb_ads_{datetime.now().strftime("%Y%m%d_%H%M%S")}.csv'
        
        with open(filename, 'w', newline='', encoding='utf-8') as f:
            writer = csv.writer(f)
            
            # –ó–∞–≥–æ–ª–æ–≤–∫–∏
            writer.writerow([
                'ad_archive_id', 'page_name', 'page_id', 'ad_text',
                'creation_time', 'start_time', 'stop_time',
                'impressions_min', 'impressions_max',
                'spend_min', 'spend_max', 'currency',
                'platforms', 'snapshot_url'
            ])
            
            for ad in self.ads:
                bodies = ad.get('ad_creative_bodies', [])
                text = bodies[0] if bodies else ''
                
                imp = ad.get('impressions', {})
                spend = ad.get('spend', {})
                platforms = ad.get('publisher_platforms', [])
                
                writer.writerow([
                    ad.get('ad_archive_id', ''),
                    ad.get('page_name', ''),
                    ad.get('page_id', ''),
                    text[:500],
                    ad.get('ad_creation_time', ''),
                    ad.get('ad_delivery_start_time', ''),
                    ad.get('ad_delivery_stop_time', ''),
                    imp.get('lower_bound', '') if isinstance(imp, dict) else imp,
                    imp.get('upper_bound', '') if isinstance(imp, dict) else '',
                    spend.get('lower_bound', '') if isinstance(spend, dict) else spend,
                    spend.get('upper_bound', '') if isinstance(spend, dict) else '',
                    ad.get('currency', ''),
                    ', '.join(platforms) if platforms else '',
                    ad.get('ad_snapshot_url', '')
                ])
        
        print(f'üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ {filename}')
    
    def save_json(self, filename=None):
        """–°–æ—Ö—Ä–∞–Ω–∏—Ç—å –≤ JSON"""
        if not self.ads:
            print('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–æ—Ö—Ä–∞–Ω–µ–Ω–∏—è')
            return
        
        if not filename:
            filename = f'fb_ads_{datetime.now().strftime("%Y%m%d_%H%M%S")}.json'
        
        with open(filename, 'w', encoding='utf-8') as f:
            json.dump(self.ads, f, indent=2, ensure_ascii=False)
        
        print(f'üíæ –°–æ—Ö—Ä–∞–Ω–µ–Ω–æ –≤ {filename}')


# ===== –ò–°–ü–û–õ–¨–ó–û–í–ê–ù–ò–ï =====
if __name__ == '__main__':
    
    # –í–∞—à Access Token
    ACCESS_TOKEN = 'YOUR_ACCESS_TOKEN_HERE'
    
    # –°–æ–∑–¥–∞–µ–º –∫–ª–∏–µ–Ω—Ç
    api = FacebookAdsLibraryAPI(ACCESS_TOKEN)
    
    # –í–∞—Ä–∏–∞–Ω—Ç 1: –ü–æ–∏—Å–∫ –ø–æ Page ID
    ads = api.get_ads_by_page(
        page_id='123456789',      # –ß–∏—Å–ª–æ–≤–æ–π ID —Å—Ç—Ä–∞–Ω–∏—Ü—ã
        countries=['US', 'GB'],    # –°—Ç—Ä–∞–Ω—ã (–æ–±—è–∑–∞—Ç–µ–ª—å–Ω–æ!)
        ad_type='ALL',
        limit=100
    )
    
    # –í–∞—Ä–∏–∞–Ω—Ç 2: –ü–æ–∏—Å–∫ –ø–æ –∫–ª—é—á–µ–≤—ã–º —Å–ª–æ–≤–∞–º  
    # ads = api.get_ads_by_keyword(
    #     search_terms='fitness supplements',
    #     countries=['US'],
    #     ad_type='ALL',
    #     limit=100
    # )
    
    # –°–æ—Ö—Ä–∞–Ω–µ–Ω–∏–µ
    if ads:
        api.save_csv()
        api.save_json()
                </div>
            </div>
        </div>
    </div>

    <script>
        let allAds = [];
        let searchMode = 'page';
        let lastRequestUrl = '';

        function setSearchMode(mode) {
            searchMode = mode;
            
            document.getElementById('mode-page').classList.toggle('active', mode === 'page');
            document.getElementById('mode-keyword').classList.toggle('active', mode === 'keyword');
            
            document.getElementById('pageSearchFields').style.display = mode === 'page' ? 'block' : 'none';
            document.getElementById('keywordSearchFields').style.display = mode === 'keyword' ? 'block' : 'none';
        }

        function getSelectedCountries() {
            const checkboxes = document.querySelectorAll('#countrySelect input:checked');
            return Array.from(checkboxes).map(cb => cb.value);
        }

        function buildApiUrl() {
            const accessToken = document.getElementById('accessToken').value;
            const pageId = document.getElementById('pageId').value;
            const searchTerms = document.getElementById('searchTerms').value;
            const countries = getSelectedCountries();
            const adType = document.getElementById('adType').value;
            const adStatus = document.getElementById('adStatus').value;
            const limit = document.getElementById('limit').value;
            const mediaType = document.getElementById('mediaType').value;
            const platform = document.getElementById('publisherPlatform').value;

            const url = new URL('https://graph.facebook.com/v21.0/ads_archive');
            
            // –û–±—è–∑–∞—Ç–µ–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            url.searchParams.append('access_token', accessToken || 'YOUR_TOKEN');
            url.searchParams.append('ad_reached_countries', JSON.stringify(countries));
            url.searchParams.append('ad_type', adType);
            url.searchParams.append('limit', limit);
            
            // –ü–æ–ª—è –¥–ª—è –ø–æ–ª—É—á–µ–Ω–∏—è
            const fields = [
                'id', 'ad_archive_id', 'ad_creation_time', 'ad_creative_bodies',
                'ad_creative_link_captions', 'ad_creative_link_descriptions',
                'ad_creative_link_titles', 'ad_delivery_start_time', 'ad_delivery_stop_time',
                'ad_snapshot_url', 'bylines', 'currency', 'delivery_by_region',
                'demographic_distribution', 'estimated_audience_size', 'impressions',
                'languages', 'page_id', 'page_name', 'publisher_platforms',
                'spend', 'target_ages', 'target_gender', 'target_locations'
            ];
            url.searchParams.append('fields', fields.join(','));
            
            // –£—Å–ª–æ–≤–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã
            if (searchMode === 'page' && pageId) {
                url.searchParams.append('search_page_ids', pageId);
            }
            
            if (searchMode === 'keyword' && searchTerms) {
                url.searchParams.append('search_terms', searchTerms);
            }
            
            if (adStatus) {
                url.searchParams.append('ad_active_status', adStatus);
            }
            
            if (mediaType) {
                url.searchParams.append('media_type', mediaType);
            }
            
            if (platform) {
                url.searchParams.append('publisher_platforms', JSON.stringify([platform]));
            }

            return url.toString();
        }

        function updateRequestDisplay() {
            const url = buildApiUrl();
            document.getElementById('requestUrl').textContent = url;
            document.getElementById('curlCommand').textContent = `curl -G "${url.split('?')[0]}" \\\n  --data-urlencode "access_token=YOUR_TOKEN" \\\n  ... (–æ—Å—Ç–∞–ª—å–Ω—ã–µ –ø–∞—Ä–∞–º–µ—Ç—Ä—ã)`;
        }

        async function testConnection() {
            const accessToken = document.getElementById('accessToken').value;
            
            if (!accessToken) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ Access Token', 'error');
                return;
            }

            showAlert('–¢–µ—Å—Ç–∏—Ä–æ–≤–∞–Ω–∏–µ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è...', 'info');
            
            try {
                const response = await fetch(`https://graph.facebook.com/v21.0/me?access_token=${accessToken}`);
                const data = await response.json();
                
                if (data.error) {
                    showAlert(`‚ùå –û—à–∏–±–∫–∞ —Ç–æ–∫–µ–Ω–∞: ${data.error.message}`, 'error');
                } else {
                    showAlert(`‚úÖ –¢–æ–∫–µ–Ω –≤–∞–ª–∏–¥–Ω—ã–π! –ü–æ–ª—å–∑–æ–≤–∞—Ç–µ–ª—å: ${data.name || data.id}`, 'success');
                }
            } catch (error) {
                showAlert(`‚ùå –û—à–∏–±–∫–∞ –ø–æ–¥–∫–ª—é—á–µ–Ω–∏—è: ${error.message}`, 'error');
            }
        }

        async function fetchAds() {
            const accessToken = document.getElementById('accessToken').value;
            const pageId = document.getElementById('pageId').value;
            const searchTerms = document.getElementById('searchTerms').value;
            const countries = getSelectedCountries();

            // –í–∞–ª–∏–¥–∞—Ü–∏—è
            if (!accessToken) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ Access Token', 'error');
                return;
            }

            if (countries.length === 0) {
                showAlert('–í—ã–±–µ—Ä–∏—Ç–µ –º–∏–Ω–∏–º—É–º –æ–¥–Ω—É —Å—Ç—Ä–∞–Ω—É', 'error');
                return;
            }

            if (searchMode === 'page' && !pageId) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ Page ID', 'error');
                return;
            }

            if (searchMode === 'keyword' && !searchTerms) {
                showAlert('–í–≤–µ–¥–∏—Ç–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –¥–ª—è –ø–æ–∏—Å–∫–∞', 'error');
                return;
            }

            // –ü–æ–∫–∞–∑—ã–≤–∞–µ–º URL –∑–∞–ø—Ä–æ—Å–∞
            lastRequestUrl = buildApiUrl();
            updateRequestDisplay();
            
            showLoading(true, '–û—Ç–ø—Ä–∞–≤–∫–∞ –∑–∞–ø—Ä–æ—Å–∞ –∫ Ads Library API...');
            clearAlerts();
            document.getElementById('resultsSection').classList.add('active');

            try {
                const response = await fetch(lastRequestUrl);
                const data = await response.json();

                if (data.error) {
                    let errorMsg = `‚ùå –û—à–∏–±–∫–∞ API: ${data.error.message}`;
                    
                    // –ü–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–∏–ø–∏—á–Ω—ã–º –æ—à–∏–±–∫–∞–º
                    if (data.error.code === 190) {
                        errorMsg += '\n\nüí° –¢–æ–∫–µ–Ω –Ω–µ–≤–∞–ª–∏–¥–Ω—ã–π –∏–ª–∏ –∏—Å—Ç—ë–∫. –°–≥–µ–Ω–µ—Ä–∏—Ä—É–π—Ç–µ –Ω–æ–≤—ã–π —Ç–æ–∫–µ–Ω.';
                    } else if (data.error.code === 10) {
                        errorMsg += '\n\nüí° –ù–µ–¥–æ—Å—Ç–∞—Ç–æ—á–Ω–æ –ø—Ä–∞–≤. –ü—Ä–æ–≤–µ—Ä—å—Ç–µ permissions —Ç–æ–∫–µ–Ω–∞.';
                    } else if (data.error.message.includes('ad_reached_countries')) {
                        errorMsg += '\n\nüí° –ü–∞—Ä–∞–º–µ—Ç—Ä ad_reached_countries –æ–±—è–∑–∞—Ç–µ–ª–µ–Ω. –í—ã–±–µ—Ä–∏—Ç–µ —Å—Ç—Ä–∞–Ω—ã.';
                    }
                    
                    showAlert(errorMsg, 'error');
                    showLoading(false);
                    return;
                }

                allAds = data.data || [];
                
                // –ü–∞–≥–∏–Ω–∞—Ü–∏—è - –∑–∞–≥—Ä—É–∂–∞–µ–º –≤—Å–µ —Å—Ç—Ä–∞–Ω–∏—Ü—ã
                let nextUrl = data.paging?.next;
                let pageCount = 1;
                
                while (nextUrl && pageCount < 10) { // –õ–∏–º–∏—Ç 10 —Å—Ç—Ä–∞–Ω–∏—Ü
                    pageCount++;
                    showLoading(true, `–ó–∞–≥—Ä—É–∑–∫–∞ —Å—Ç—Ä–∞–Ω–∏—Ü—ã ${pageCount}...`);
                    
                    const nextResponse = await fetch(nextUrl);
                    const nextData = await nextResponse.json();
                    
                    if (nextData.data) {
                        allAds = allAds.concat(nextData.data);
                    }
                    
                    nextUrl = nextData.paging?.next;
                }

                displayResults(allAds);
                showAlert(`‚úÖ –ó–∞–≥—Ä—É–∂–µ–Ω–æ ${allAds.length} –æ–±—ä—è–≤–ª–µ–Ω–∏–π`, 'success');

            } catch (error) {
                showAlert(`‚ùå –û—à–∏–±–∫–∞ —Å–µ—Ç–∏: ${error.message}`, 'error');
            } finally {
                showLoading(false);
            }
        }

        function displayResults(ads) {
            // –°—Ç–∞—Ç–∏—Å—Ç–∏–∫–∞
            const stats = {
                total: ads.length,
                pages: [...new Set(ads.map(a => a.page_name).filter(Boolean))].length,
                platforms: [...new Set(ads.flatMap(a => a.publisher_platforms || []))],
                totalSpend: ads.reduce((sum, a) => {
                    const spend = a.spend?.lower_bound || 0;
                    return sum + parseFloat(spend);
                }, 0)
            };

            document.getElementById('stats').innerHTML = `
                <div class="stat-card">
                    <div class="stat-number">${stats.total}</div>
                    <div class="stat-label">–û–±—ä—è–≤–ª–µ–Ω–∏–π</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.pages}</div>
                    <div class="stat-label">–°—Ç—Ä–∞–Ω–∏—Ü</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">${stats.platforms.length}</div>
                    <div class="stat-label">–ü–ª–∞—Ç—Ñ–æ—Ä–º</div>
                </div>
                <div class="stat-card">
                    <div class="stat-number">$${stats.totalSpend.toLocaleString()}</div>
                    <div class="stat-label">–ú–∏–Ω. –∑–∞—Ç—Ä–∞—Ç—ã</div>
                </div>
            `;

            // –°–ø–∏—Å–æ–∫ –æ–±—ä—è–≤–ª–µ–Ω–∏–π
            const adsHtml = ads.slice(0, 100).map(ad => {
                const bodies = ad.ad_creative_bodies || [];
                const text = bodies[0] || '–¢–µ–∫—Å—Ç –Ω–µ–¥–æ—Å—Ç—É–ø–µ–Ω';
                const impressions = ad.impressions || {};
                const spend = ad.spend || {};
                const platforms = ad.publisher_platforms || [];

                return `
                    <div class="ad-item">
                        <div class="ad-title">${text.substring(0, 150)}${text.length > 150 ? '...' : ''}</div>
                        <div class="ad-meta">
                            <div class="meta-item">
                                <span>–°—Ç—Ä–∞–Ω–∏—Ü–∞:</span>
                                <span>${ad.page_name || 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span>Page ID:</span>
                                <span>${ad.page_id || 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span>Impressions:</span>
                                <span>${impressions.lower_bound || '?'} - ${impressions.upper_bound || '?'}</span>
                            </div>
                            <div class="meta-item">
                                <span>Spend:</span>
                                <span>${spend.lower_bound || '?'} - ${spend.upper_bound || '?'} ${ad.currency || ''}</span>
                            </div>
                            <div class="meta-item">
                                <span>–ü–ª–∞—Ç—Ñ–æ—Ä–º—ã:</span>
                                <span>${platforms.join(', ') || 'N/A'}</span>
                            </div>
                            <div class="meta-item">
                                <span>–°–æ–∑–¥–∞–Ω–æ:</span>
                                <span>${ad.ad_creation_time || 'N/A'}</span>
                            </div>
                        </div>
                        ${ad.ad_snapshot_url ? `
                        <div class="ad-link">
                            <a href="${ad.ad_snapshot_url}" target="_blank">üîó –ü–æ—Å–º–æ—Ç—Ä–µ—Ç—å –æ–±—ä—è–≤–ª–µ–Ω–∏–µ</a>
                        </div>
                        ` : ''}
                    </div>
                `;
            }).join('');

            document.getElementById('adsContainer').innerHTML = adsHtml || 
                '<p style="padding: 20px; text-align: center; color: #999;">–û–±—ä—è–≤–ª–µ–Ω–∏—è –Ω–µ –Ω–∞–π–¥–µ–Ω—ã</p>';
            
            if (ads.length > 100) {
                document.getElementById('adsContainer').innerHTML += 
                    `<p style="padding: 10px; text-align: center; color: #666; background: #f0f0f0;">
                        –ü–æ–∫–∞–∑–∞–Ω–æ 100 –∏–∑ ${ads.length}. –°–∫–∞—á–∞–π—Ç–µ CSV/JSON –¥–ª—è –ø–æ–ª–Ω–æ–≥–æ —Å–ø–∏—Å–∫–∞.
                    </p>`;
            }
        }

        function downloadCSV() {
            if (allAds.length === 0) {
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            const headers = [
                'ad_archive_id', 'page_name', 'page_id', 'ad_text',
                'creation_time', 'start_time', 'stop_time',
                'impressions_min', 'impressions_max', 
                'spend_min', 'spend_max', 'currency',
                'platforms', 'snapshot_url'
            ];

            const rows = allAds.map(ad => {
                const bodies = ad.ad_creative_bodies || [];
                const text = (bodies[0] || '').replace(/"/g, '""').replace(/\n/g, ' ');
                const impressions = ad.impressions || {};
                const spend = ad.spend || {};
                const platforms = ad.publisher_platforms || [];

                return [
                    ad.ad_archive_id || '',
                    (ad.page_name || '').replace(/"/g, '""'),
                    ad.page_id || '',
                    text.substring(0, 500),
                    ad.ad_creation_time || '',
                    ad.ad_delivery_start_time || '',
                    ad.ad_delivery_stop_time || '',
                    impressions.lower_bound || '',
                    impressions.upper_bound || '',
                    spend.lower_bound || '',
                    spend.upper_bound || '',
                    ad.currency || '',
                    platforms.join('; '),
                    ad.ad_snapshot_url || ''
                ];
            });

            const csv = [headers, ...rows].map(row => 
                row.map(cell => `"${cell}"`).join(',')
            ).join('\n');

            downloadFile(csv, `fb_ads_${Date.now()}.csv`, 'text/csv;charset=utf-8');
            showAlert('‚úÖ CSV —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω', 'success');
        }

        function downloadJSON() {
            if (allAds.length === 0) {
                showAlert('–ù–µ—Ç –¥–∞–Ω–Ω—ã—Ö –¥–ª—è —Å–∫–∞—á–∏–≤–∞–Ω–∏—è', 'warning');
                return;
            }

            const json = JSON.stringify(allAds, null, 2);
            downloadFile(json, `fb_ads_${Date.now()}.json`, 'application/json');
            showAlert('‚úÖ JSON —Ñ–∞–π–ª —Å–∫–∞—á–∞–Ω', 'success');
        }

        function downloadFile(content, filename, type) {
            const BOM = '\uFEFF';
            const blob = new Blob([BOM + content], { type });
            const url = window.URL.createObjectURL(blob);
            const a = document.createElement('a');
            a.href = url;
            a.download = filename;
            document.body.appendChild(a);
            a.click();
            window.URL.revokeObjectURL(url);
            document.body.removeChild(a);
        }

        function showAlert(message, type) {
            const alertsDiv = document.getElementById('alerts');
            const alertDiv = document.createElement('div');
            alertDiv.className = `alert alert-${type}`;
            alertDiv.innerHTML = message.replace(/\n/g, '<br>');
            alertsDiv.appendChild(alertDiv);

            if (type !== 'error') {
                setTimeout(() => alertDiv.remove(), 5000);
            }
        }

        function clearAlerts() {
            document.getElementById('alerts').innerHTML = '';
        }

        function showLoading(show, text = '–ó–∞–≥—Ä—É–∑–∫–∞...') {
            document.getElementById('loading').classList.toggle('active', show);
            document.getElementById('loadingText').textContent = text;
            document.getElementById('fetchBtn').disabled = show;
        }

        function clearForm() {
            document.getElementById('accessToken').value = '';
            document.getElementById('pageId').value = '';
            document.getElementById('searchTerms').value = '';
            document.querySelectorAll('#countrySelect input').forEach(cb => {
                cb.checked = cb.value === 'US';
            });
            document.getElementById('adType').value = 'ALL';
            document.getElementById('adStatus').value = '';
            document.getElementById('limit').value = '100';
            document.getElementById('mediaType').value = '';
            document.getElementById('publisherPlatform').value = '';
            document.getElementById('resultsSection').classList.remove('active');
            allAds = [];
            clearAlerts();
            setSearchMode('page');
        }

        function switchTab(tab) {
            document.querySelectorAll('.tab-content').forEach(el => el.classList.remove('active'));
            document.querySelectorAll('.tab-btn').forEach(el => el.classList.remove('active'));

            document.getElementById(tab).classList.add('active');
            event.target.classList.add('active');
            
            if (tab === 'request') {
                updateRequestDisplay();
            }
        }

        // –ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è
        document.addEventListener('DOMContentLoaded', () => {
            setSearchMode('page');
        });
    </script>
</body>
</html>
